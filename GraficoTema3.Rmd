---
title: "PRUEBA1"
output: html_document
date: "2024-03-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(readr)
library(ggplot2)
library(plotlib)
owid_covid_data <- read_csv("owid-covid-data.csv", 
    col_types = cols(date = col_date(format = "%Y-%m-%d")))
# Filtrar los datos para incluir solo EEUU e Italia
owid_covid_data_filtered <- owid_covid_data %>%
  filter(location %in% c("United States", "Italy", "United Kingdom","Canada","Japan","Spain"))

# Agrupar los datos por intervalos de 7 días y calcular el promedio semanal de nuevas muertes confirmadas por millón de personas para cada país
owid_covid_data_filtered_weekly <- owid_covid_data_filtered %>%
  mutate(week = cut(date, breaks = "1 week")) %>%
  group_by(location, week) %>%
  summarise(average_new_deaths_per_million = mean(new_deaths_per_million, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(week = as.Date(week))

# Visualizar los datos con líneas solamente y ajustar la escala del eje y
grafico <- ggplot(data = owid_covid_data_filtered_weekly, aes(x = week, y = average_new_deaths_per_million, color = location)) +
  geom_line(aes(y = average_new_deaths_per_million, group = location, show.legend = FALSE)) +
  geom_hline(yintercept = 0, color = "azure4", show.legend = FALSE) +
  labs(title = "Daily new confirmed COVID-19 deaths per million people",
       subtitle = "7-day rolling average. Due to varying protocols and challenges in the attribution of the cause of death, the number of confirmed deaths may not accurately represent the true number of deaths caused by COVID-19.",
       x = "Week",
       y = "Average Deaths per million",
       color = "Location") +
  scale_y_continuous(limits = c(0, NA), breaks = seq(0, 18, by = 2)) +
  scale_x_date(date_breaks = "35 weeks", date_labels = "%b %d, %Y", limits = c(as.Date("2020-02-12"), as.Date("2024-02-28"))) +
  #expand_limits(x = as.Date(c("2020-02-13", last_date))) +
  theme_minimal() +
  theme(panel.background = element_blank(),
        panel.grid.major.y = element_line(color = "grey", linetype = "dashed"),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text( hjust = 0.5, vjust = 1),
        plot.title = element_text(face = "bold", color = "azure4"),  # Para hacer el título en negrita
        plot.subtitle = element_text(color = "azure4"))  # Para cambiar el color del subtítulo)
  

grafico


```


